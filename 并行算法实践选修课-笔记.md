# 并行算法实践-笔记

## 一、日常使用

#### 1、并发方式：mpi、openmp

-  `mpi` ：并发系统手动挡，本实验使用

- ` openmp` ：并发系统自动挡，本实验不适用

- `mpi` 和 `openmp` 的对比 ：

  |   指标   |  MPI   | openMP |
  | :-----: | :------------: | :------------: |
  |   粒度   |  进程  |  线程  |
  |   存储   | 分布式 | 共享式 |
  | 数据分布 |  显式  |  隐式  |
  | 可扩展性 |  较好  |  较差  |

  

#### 2、远程登录方式

-  `minicom` ：主要用于修改 ` IP`  地址，修改密码等。

  ```
  进入方式：首先选择进入的核心编号 `gpio number` ，再输入minicom。
  退出方式：ctrl+A  ->  x  ->  回到前端
  ```

-  `SSH` 登录：本实验日常使用方式，例：

  ```
  ssh root@192.168.100.1         //ssh登录
  ```

  

## 二、实验运行
#### 1、单实验箱运行步骤(基本完善）

- 在前端状态下，利用 ` scp ` 工具把代码上传到待使用的核心，例如: 

  ```sh
  scp /path/file  User@host:/LocalPathorFile      //这是标准语句格式
  scp rank.c root@192.168.100.1:/location         //这是实际用例。省略地址会默认上传到主目录
  ```

- 此时进入高性能核心，如有必要，请修改 `mpd.hosts` 文件

- 编译程序： `mpicc`       （可在程序文件夹的 `README` 查看具体用法）

- 在核心中设置运行程序的核心**数量**：
  ```sh
  mpdboot -n 1~4 -f mpd.hosts          //中间的1~4，填入一个数
  mpdtrace                             //若启用成功，此命令会输出启用核心的列表
  ```

- 运行程序：` mpirun`    （可在程序文件夹的 `README` 查看具体用法，编译成功无法运行可尝试在文件前加上“ ./ ”）


#### 2、多盒子串联运行步骤（待完善）
-  `ifconfig`  查看当前  `IP` 

-  `gpio 1`  启用  `1` 号多处理器

- 设置  ` IP`  ：

  ```
  ifconfig eth1 192.168.100.38 netmask 255.255.255.0
  ```

- 重启系统，倒数时按任意键暂停，此时修改启动 ` IP`  ：

  ```
  （PMON串口调试）：setmac2：~~~~~~~~~~~~：0x（ x 为想要的编号）
  set nfsip 192.168.0.0x（ x 为想要的编号）（默认 IP：192.168.0.250）
  ```

- 正常重启

-  `ping`  另一个箱子的处理器  `IP`  （成功即连上）

  


## 三、问题处理
#### 1、更改核心的登录密码

- 有的核心的密码被改过，上传文件和登录核心都会失败，此时需要更改核心登陆密码。具体代码如下：

  ```
  gpio 1             //选择更改的核心序号：1~4
  minicom            //进入此核心
  passwd             //输入更改密码命令
  请输入你的密码：
  ```

#### 2、查看核心的IP地址

- 登录核心后输入：`ifconfig `  即可 

#### 3、分辨前端节点和高性能核心

- ` [root ~*%^%*&$] `：      带中括号的是前端节点。

- ` root ~*%^%*&$  `  ：      **不带**中括号的是高性能核心。

#### 4、程序可以编译但是无法运行

- 可尝试在可尝试在运行文件前加上  “ ` ./`  ” ，使用当前目录
- 可能没有设置启动参数，可以通过  `mpdboot -n 1~4 -f mpd.hosts`  设置。
- 设置启用参数仍然无法运行，可能  `mpd.hosts`  文件内容需要更改。

#### 5、`scp` 上传代码成功，但是在高性能核心无法找到文件

- 上传文件时如果没有写目标地址，则会传到主目录下
- 我们登录远程高性能核心以后在 `root` 目录下，所以会造成找不到的错觉
- 2 个解决办法：返回主目录查找或者 `scp` 上传时把目的地址写上

#### 6、关于 mpd.hosts 文件

- 放在主处理单元的 `home` 目录下即可

- `mpdboot -n 2 -f mpd.hosts` ，此命令中间的 `2` 的意思是启用 `mpd.hosts` 文件中前两个节点

- `mpdtrace` 命令可查看启用核心的列表

- `mpd.hosts` 参考写法：

  ```
  loongsonbox-n1
  loongsonbox-n2
  loongsonbox-n3
  loongsonbox-n4
  ```


#### 7、传输文件

- `scp file sdbox@ip:/path`

#### 8、远程登录并控制-龙芯盒子

- 在关机状态下，把网线插入最左边网线接口，开机

- 用 ` ifconfig` 查看前端系统的 `eth0  IP` 地址，并记住

- 用 `SSH` 登录，最后一行表示登录成功

  <div align=center>
  <img src="images\002.png#pic_center" width="40%" alt="标题"/>
  </div>

- 远程控制硬件开关：在自己电脑浏览器地址中输入： `IP/loongson-start.html` 即可控制核心开关。

  <div align=center>
  <img src="images\001.png#pic_center" width="85%" alt="标题"/>
  </div>





### Reference

[并行计算：MPI总结](https://blog.csdn.net/qq_40765537/article/details/106425355)

[此实验箱简介](http://www.loongson.cn/business/general2/jiaoxue/jiaoxueshiyanxiang/2015/09/69.html)

[scp命令语法](https://blog.csdn.net/weixin_34177064/article/details/92177168)

[README书写规范](https://github.com/guodongxiaren/README)


